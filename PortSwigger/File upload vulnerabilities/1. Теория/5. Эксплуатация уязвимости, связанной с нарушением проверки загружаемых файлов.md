В реальных условиях редко встретишь веб-сайт, который совсем не защищён от атак, связанных с загрузкой вредоносных файлов, наподобие тех, что мы наблюдали в предыдущей лаборатории. Однако наличие защиты вовсе не означает её надёжность. Иногда всё ещё возможно воспользоваться недостатками механизмов контроля загрузки, чтобы внедрить веб-оболочку для удалённого исполнения произвольного кода.

**Некорректная проверка типа файла**
При отправке HTML-форм браузер обычно посылает введённые данные методом POST с типом содержимого `application/x-www-form-urlencoded`. Это подходит для передачи простого текста вроде имени или адреса. Но этот способ непригоден для отправки больших объёмов бинарных данных, таких как полный файл изображения или документа PDF. В таком случае предпочтительнее использовать тип содержимого `multipart/form-data`.
Рассмотрим форму, содержащую поля для загрузки изображения, ввода описания и указания вашего имени пользователя. Отправка подобной формы может привести к запросу примерно следующего вида:

*POST /images HTTP/1.1 Host: normal-website.com 
	Host: normal-website.com Content-Length: 12345 Content-Type: multipart/form-data; boundary=---------------------------012345678901234567890123456 ---------------------------012345678901234567890123456
	Content-Disposition: form-data; name="image"; filename="example.jpg" Content-Type: image/jpeg [...binary content of example.jpg...] ---------------------------012345678901234567890123456 
	Content-Disposition: form-data; name="description"

Как видно, тело сообщения разделено на отдельные части для каждого из полей формы. Каждая такая часть включает заголовок `Content-Disposition`, содержащий базовую информацию о соответствующем поле ввода. Отдельные части также могут содержать собственный заголовок `Content-Type`, сообщающий серверу MIME-тип данных, переданных через данное поле.

Один из способов, которым веб-сайты пытаются проверять загружаемые файлы, заключается в проверке соответствия заголовка `Content-Type` конкретного поля ожидаемому типу MIME. Например, если сервер ожидает только графические файлы, он может разрешать типы данных только `image/jpeg` и `image/png`.
Проблемы возникают тогда, когда значение этого заголовка неявно принимается сервером как доверенное. Если не выполняется дополнительная проверка на соответствие фактического содержимого файла заявленному типу MIME, такую защиту легко обойти с использованием инструментов вроде Burp Repeater.

Типы MIME:
	- application - данные приложений или бинарные данные;
	- audio - аудиофайлы или потоки;
	- example - пример данных;
	- image - изображение
	- message - целые сообщения (электронные письма)
	- model - 3D-модели
	- multipart - сообщения из нескольких частей
	- text - текстовые данные
	- video - видеофайлы